var Host="https://product-reviews-apps.haravan.com/",ProductReviews=function(){jQuery("#hrv-product-reviews"),window.location.hostname;var e=1,r=5,t="#ECBA55",a=!1,o="Bài viết này có hữu ích?",s={LoadProductReviewCSS:function(){LoadCSS(Host+"css/ProductReviews.css")},LoadRatingCSS:function(){LoadCSS(Host+"css/jquery.raty.css"),$('link[href*="font-awesome.min.css"]').length<=0&&$("head").append('<link rel="stylesheet" href="//hstatic.net/0/0/global/design/plugins/font-awesome/4.6.3/css/font-awesome.min.css" type="text/css" />')},CreateDivSummary:function(){if(jQuery("#hrv-product-reviews-list").before('<span class="product-reviews-summary-actions"><input type="button" id="btnnewreview" value = "Viết đánh giá" /></span>'),$("#hrv-product-reviews").hasClass("hrv-votesmile-reviews")){var e="";e+='<span id="mssgReviewbyPage">'+o+"</span>",e+='<div><i class="fa fa-smile-o voteReivew" id="smilevote"></i>',e+='<i class="fa fa-frown-o voteReivew"  id="frownvote"></i></div>',jQuery("#hrv-product-reviews").html(e)}},CreateSubmitForm:function(){if(!$("#hrv-product-reviews").hasClass("hrv-votesmile-reviews")){var e="";e+='<div class="hrv-product-reviews-form" id="hrv-product-reviews-form" style="display:none">',e+="<h3>Viết đánh giá mới</h3>",e+='<form id="hrv-product-reviews-frm" name="hrv-product-reviews-frm" >',e+="<fieldset>",e+='<div id="dvName">',e+="<label>Tên</label>",e+='<input id="hrv_product_reviews_form_name"  type="text" placeholder="Tên của bạn (>3 ký tự và < 20 ký tự)" autocomplete="off"></input>',e+='<div id="msg_name" style="display:none; color:red; margin-top:10px;">Tên của bạn phải từ 3 đến 20 ký tự, vui lòng nhập lại.</div>',e+='<div id="msg_name_validate" style="display:none; color:red; margin-top:10px;">Tên của bạn không hợp lệ, vui lòng nhập lại.</div>',e+="</div>",e+="</fieldset>",e+="<fieldset>",e+='<div id="dvEmail">',e+="<label>Email</label>",e+='<input id="hrv_product_reviews_form_email"  type="text" placeholder="john.smith@example.com" autocomplete="off"></input>',e+='<div id="msg_email" style="display:none; color:red; margin-top:10px;">Email không đúng định dạng, vui lòng nhập lại.</div>',e+="</div>",e+="</fieldset>",e+='<fieldset id="hrv_product_reviews_form_fieldset_rate">',e+="<label>Đánh giá</label>",e+='<div id="dvRating" >',e+="</div>",e+='<input type="hidden" id="hrv_product_reviews_form_rate" value="5"/>',Haravan?e+='<input type="hidden" id="hrv_product_reviews_form_shop" value="'+Haravan.shop+'"/>':e+='<input type="hidden" id="hrv_product_reviews_form_shop" value="'+window.location.hostname+'"/>',e+='<input type="hidden" id="hrv_product_reviews_form_fullshop" value="'+window.location.protocol+"//"+window.location.hostname+'/"/>',e+='<input type="hidden" id="hrv_product_reviews_form_product" id="hrv_product_reviews_form_product" value="'+jQuery("#hrv-product-reviews").attr("data-id")+'"/>',e+='<input type="hidden" id="hrv_product_reviews_form_callback" value="'+window.location+'" />';var r=window.location.href.split("/");e+='<input type="hidden" id="hrv_product_reviews_form_product_name" value="'+r[r.length-1]+'" />',e+="</fieldset>",e+="<fieldset>",e+='<div id="dvTitle">',e+="<label>Tiêu đề</label>",e+='<input id="hrv_product_reviews_form_title" type="text" placeholder="Hãy cho một tiêu đề (>3 ký tự và < 50 ký tự)" autocomplete="off"></input>',e+='<div id="msg_title" style="display:none; color:red; margin-top:10px;">Độ dài tiêu đề phải từ 3 đến 50 ký tự, vui lòng nhập lại.</div>',e+='<div id="msg_title_validate" style="display:none; color:red; margin-top:10px;">Tiêu đề của bạn không hợp lệ, vui lòng nhập lại.</div>',e+="</div>",e+="</fieldset>",e+="<fieldset>",e+='<div id="dvBody">',e+='<label>Nội dung</label> <label id="dvBody_character"></label>',e+='<textarea id="hrv_product_reviews_form_body"  rows="10" placeholder="Viết nội dung đánh giá ở đây (>3 ký tự và < 1000 ký tự)"></textarea>',e+='<div id="msg_body" style="display:none; color:red; margin-top:10px;">Độ dài nội dung phải từ 3 đến 1000 ký tự, vui lòng nhập lại.</div>',e+='<div id="msg_body_validate" style="display:none; color:red; margin-top:10px;">Nội dung của bạn không hợp lệ, vui lòng nhập lại.</div>',e+="</div>",e+="</fieldset>",e+='<p class="error" />',e+='<input type="submit" id="btnSubmitReview" value="Gửi đánh giá" width="80"></input> ',e+="</form>",e+="<br />",e+="</div>",e+='<div class="hrv-product-reviews-form" id="hrv-product-reviews-thanks" style="display:none; padding-top:20px" >',e+="<center><b>Cám ơn bạn đã đánh giá sản phẩm!</b><center>",e+="</div>",e+="<br />",jQuery("#hrv-product-reviews-list").before(e)}},VotePage:function(){if(jQuery(".reviews-quick").on("click",function(){var e=jQuery(this),r=e.attr("data-type"),t=e.attr("data-blogid")+"-"+e.attr("data-id"),i=e.attr("rate");d.AddNewReview(i,t,r)}),$("#hrv-product-reviews").hasClass("hrv-votesmile-reviews")){var e=$("#hrv-product-reviews").attr("data-type")+"-"+$("#hrv-product-reviews").attr("data-id"),r=getCookie(e);null!=r&&(jQuery("#smilevote").css({color:"true"==r?t:"#587887"}).addClass("true"==r?"voteReivewed":""),jQuery("#frownvote").css({color:"false"==r?t:"#587887"}).addClass("false"==r?"voteReivewed":"")),jQuery("#smilevote").on("click",function(){"true"!=(r=getCookie(e))&&(jQuery("#smilevote").css({color:t}).addClass("voteReivewed"),jQuery("#frownvote").css({color:"#587887"}).removeClass("voteReivewed"),setCookie(e,!0),d.AddNewReview("5"),jQuery("#mssgReviewbyPage").text("Cám ơn bạn đã phản hồi!"))}),jQuery("#frownvote").on("click",function(){"false"!=(r=getCookie(e))&&(jQuery("#smilevote").css({color:"#587887"}).removeClass("voteReivewed"),jQuery("#frownvote").css({color:t}).addClass("voteReivewed"),setCookie(e,!1),d.AddNewReview("1"),jQuery("#mssgReviewbyPage").text("Cám ơn bạn đã phản hồi!"))})}}},d={AddNewReview:function(e,r,t){jQuery("#btnnewreview").hide(),jQuery("#hrv-product-reviews-thanks").show(),jQuery("#hrv-product-reviews-form").slideToggle(),null==r&&(r=null!=jQuery("#hrv-product-reviews").attr("data-blogid")?jQuery("#hrv-product-reviews").attr("data-blogid")+"-"+jQuery("#hrv-product-reviews").attr("data-id"):jQuery("#hrv-product-reviews").attr("data-id"));var i=window.location.href.split("/"),o=i[i.length-1],s=a?window.location.origin+"/apps/productreviews":Host+"clientrequest/postreview";jQuery.ajax({type:"POST",url:s,data:JSON.stringify({hrv_product_reviews_form_name:jQuery("#hrv_product_reviews_form_name").val(),hrv_product_reviews_form_email:jQuery("#hrv_product_reviews_form_email").val(),hrv_product_reviews_form_rate:null==e?jQuery("#hrv_product_reviews_form_rate").val():e,hrv_product_reviews_form_shop:Haravan?Haravan.shop:window.location.hostname,hrv_product_reviews_form_fullshop:window.location.protocol+"//"+window.location.hostname+"/",hrv_product_reviews_form_product:r,hrv_product_reviews_form_callback:window.location.href,hrv_product_reviews_form_title:jQuery("#hrv_product_reviews_form_title").val(),hrv_product_reviews_form_body:jQuery("<div/>").text(jQuery("#hrv_product_reviews_form_body").val()).html(),hrv_product_reviews_form_product_name:o,hrv_product_reviews_form_type:null==t?jQuery("#hrv-product-reviews").attr("data-type"):t}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){},error:function(e,r,t){console.log(t)}}).done(function(e){d.ResetForm()})},GetMoreReview:function(){jQuery("#btnMoreReview").on("click",function(){r+=10})},ToogleSubmitForm:function(){jQuery("#btnnewreview").on("click",function(){jQuery("#hrv-product-reviews-form").slideToggle(),jQuery("#dvRating i").css("color",t)})},ValidateSubmitForm:function(){var e=/<\/?[a-z][\s\S]*>/i;jQuery("#hrv_product_reviews_form_name").change(function(){var r=jQuery(this).val().trim();r.length<3||r.length>20?(jQuery("#msg_name").show(),jQuery("#msg_name_validate").hide(),jQuery("#dvName").addClass("has-error")):e.test(r)||r.includes("<")||r.includes(">")?(jQuery("#msg_name_validate").show(),jQuery("#msg_name").hide(),jQuery("#dvName").addClass("has-error")):(jQuery("#msg_name").hide(),jQuery("#msg_name_validate").hide(),jQuery("#dvName").removeClass("has-error"))}),jQuery("#hrv_product_reviews_form_title").change(function(){var r=jQuery(this).val().trim();r.length<3||r.length>50?(jQuery("#msg_title").show(),jQuery("#msg_title_validate").hide(),jQuery("#dvTitle").parent().addClass("has-error")):e.test(r)||r.includes("<")||r.includes(">")?(jQuery("#msg_title_validate").show(),jQuery("#msg_title").hide(),jQuery("#dvTitle").parent().addClass("has-error")):(jQuery("#msg_title").hide(),jQuery("#msg_title_validate").hide(),jQuery("#dvTitle").parent().removeClass("has-error"))}),jQuery("#hrv_product_reviews_form_email").change(function(){var e=jQuery(this).val().trim();d.IsValidEmailAddress(e)?(jQuery("#msg_email").hide(),jQuery("#dvEmail").removeClass("has-error")):(jQuery("#msg_email").show(),jQuery("#dvEmail").addClass("has-error"))}),jQuery("#hrv_product_reviews_form_body").change(function(){var r=jQuery(this).val().trim();r.length<3||r.length>1e3?(jQuery("#msg_body").show(),jQuery("#msg_body_validate").hide(),jQuery("#dvBody").parent().addClass("has-error")):e.test(r)?(jQuery("#msg_body_validate").show(),jQuery("#msg_body").hide(),jQuery("#dvBody").parent().addClass("has-error")):(jQuery("#msg_body").hide(),jQuery("#msg_body_validate").hide(),jQuery("#dvBody").parent().removeClass("has-error"))}),jQuery("#hrv_product_reviews_form_body").keyup(function(){var e=jQuery(this).val().length;jQuery("#dvBody_character").text("("+e+"/1000)")}),jQuery("#btnSubmitReview").on("click",function(){var e=!0,r=/<\/?[a-z][\s\S]*>/i,t=jQuery("#hrv_product_reviews_form_name").val().trim(),i=jQuery("#hrv_product_reviews_form_email").val().trim(),a=jQuery("#hrv_product_reviews_form_title").val().trim(),o=jQuery("#hrv_product_reviews_form_body").val().trim();return t.length<3||t.length>20?(jQuery("#msg_name").show(),jQuery("#msg_name_validate").hide(),jQuery("#dvName").addClass("has-error"),e=!1):r.test(t)||t.includes("<")||t.includes(">")?(jQuery("#msg_name_validate").show(),jQuery("#msg_name").hide(),jQuery("#dvName").addClass("has-error"),e=!1):(jQuery("#msg_name").hide(),jQuery("#msg_name_validate").hide(),jQuery("#dvName").removeClass("has-error")),""!=i&&d.IsValidEmailAddress(i)?(jQuery("#dvEmail").removeClass("has-error"),jQuery("#msg_email").hide()):(jQuery("#dvEmail").addClass("has-error"),jQuery("#msg_email").show(),e=!1),a.length<3||a.length>50?(jQuery("#msg_title").show(),jQuery("#msg_title_validate").hide(),jQuery("#dvTitle").parent().addClass("has-error"),e=!1):r.test(a)||a.includes("<")||a.includes(">")?(jQuery("#msg_title_validate").show(),jQuery("#msg_title").hide(),jQuery("#dvTitle").parent().addClass("has-error"),e=!1):(jQuery("#msg_title").hide(),jQuery("#msg_title_validate").hide(),jQuery("#dvTitle").parent().removeClass("has-error")),o.length<3||o.length>1e3?(jQuery("#msg_body").show(),jQuery("#msg_body_validate").hide(),jQuery("#dvBody").parent().addClass("has-error"),e=!1):r.test(o)?(jQuery("#msg_body_validate").show(),jQuery("#msg_body").hide(),jQuery("#dvBody").parent().addClass("has-error"),e=!1):(jQuery("#msg_body").hide(),jQuery("#msg_body_validate").hide(),jQuery("#dvBody").parent().removeClass("has-error")),e&&d.AddNewReview(),!1})},GetReview:function(r){if(null!=r){var t=jQuery("#hrv_product_reviews_form_product").val();null!=jQuery("#hrv-product-reviews").attr("data-blogid")&&(t=jQuery("#hrv-product-reviews").attr("data-blogid")+"-"+jQuery("#hrv-product-reviews").attr("data-id")),jQuery.ajax({type:"GET",dataType:"json",async:!0,url:Host+"clientrequest/getreview",data:{data:JSON.stringify({hrv_product_reviews_form_shop:jQuery("#hrv_product_reviews_form_shop").val(),hrv_product_reviews_form_product:t,hrv_product_reviews_form_fullshop:jQuery("#hrv_product_reviews_form_fullshop").val(),Take:r})},success:function(e){if(jQuery("#hrv-product-reviews-list").html(""),null!=e)for(i=0;i<e.length;i++){var r="";r+="<div itemprop='review' itemscope='' itemtype='http://schema.org/Review'>",r+="<div>",r+='<div class="hrv-product-reviews-star" data-score="'+e[i].star_rate+'" data-number="5" title=\'gorgeous\'>',r+="</div>",r+="<p style='color:#8B8B8B'>",r+="<b itemprop='name'>"+e[i].title+"</b>",r+="- <span itemprop='author'>"+e[i].name+"</span>",r+="<i itemprop='datePublished' content='"+e[i].date_create+"'> - "+e[i].date_create,r+="</i>",r+="</p>",r+="</div>",r+="<span itemprop='description'>"+e[i].body+"</span>",1==e[i].is_replied&&(r+='<div class="dvhrv-prv-reply">',r+="<p style='color:#8B8B8B'>",r+="<b>Admin</b> - "+e[i].reply_date,r+="</p>",r+="<p>",r+=e[i].reply_content,r+="</p>",r+="</div>"),r+="<div style='display:none;' itemtype='http://schema.org/Rating' itemprop='reviewRating' itemscope=''>",r+="<meta itemprop='worstRating' content='1' />",r+="<meta itemprop='bestRating' content='5' />",r+="<span itemprop='ratingValue'>"+e[i].star_rate+"</span>",r+="</div>",r+="</div>",jQuery("#hrv-product-reviews-list").append(r)}d.LoadStar()}}),e=parseInt(r,10),d.LoadPagingTool(),jQuery("#hrv-product-reviews-thanks").hide(),d.GoToByScroll("hrv-product-reviews")}},GoToByScroll:function(e){e=e.replace("link",""),jQuery("html,body").animate({scrollTop:jQuery("#"+e).offset().top},"slow")},ResetForm:function(){jQuery("#dvBody_character").val(""),jQuery("#hrv_product_reviews_form_name").val(""),jQuery("#hrv_product_reviews_form_email").val(""),jQuery("#hrv_product_reviews_form_title").val(""),jQuery("#hrv_product_reviews_form_body").val(""),d.LoadDefaultStar()},LoadStar:function(){jQuery(".hrv-product-reviews-star").raty({starType:"i",number:function(){return jQuery(this).attr("data-number")},score:function(){return jQuery(this).attr("data-score")},readOnly:!0}),jQuery(".hrv-product-reviews-star i").css("color",t),jQuery(window).resize()},LoadDefaultStar:function(){jQuery("#dvRating").raty({starType:"i",number:5,score:5,click:function(e,r){jQuery("#hrv_product_reviews_form_rate").val(e)}}),jQuery("#dvRating").css("color",t),jQuery(window).resize()},IsValidEmailAddress:function(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},ApplyLayoutSetting:function(e){jQuery.ajax({type:"GET",async:!0,url:Host+"configuration/getlayoutsetting",dataType:"json",data:{data:JSON.stringify({hrv_product_reviews_form_shop:Haravan.shop,hrv_product_reviews_form_fullshop:jQuery("#hrv_product_reviews_form_fullshop").val()})},success:function(e){}}).done(function(r){if(t=r.star_color,a=r.only_customer_ratting,$("#hrv-product-reviews").hasClass("hrv-votesmile-reviews")){var i=$("#hrv-product-reviews").attr("data-type");if(i)switch(i){case"1":o=null==r.blogs_message||0==r.blogs_message.length?o:r.blogs_message;break;case"2":o=null==r.pages_message||0==r.pages_message.length?o:r.pages_message;break;case"3":o=null==r.aricles_message||0==r.aricles_message.length?o:r.aricles_message;break;default:o="Bài viết này có hữu ích?"}}e()})},LoadNoReview:function(){jQuery(".haravan-product-reviews-badge").each(function(){0==jQuery(this).children().length&&(jQuery(this).append('<div class="hrv-product-reviews-star" data-score="0" data-number="5" ></div>'),jQuery(this).append("</div><p>(0 đánh giá)</p></div>"))}),0==jQuery(".hrv-product-reviews-summary").children().length&&jQuery(".hrv-product-reviews-summary").append('<div style="text-align: center"><div class="hrv-product-reviews-star"  data-score="0" data-number="5" ></div><span>(0 đánh giá)</span></div>')},LoadPagingTool:function(){var t=jQuery("#hrv_product_reviews_form_product").val();null!=jQuery("#hrv-product-reviews").attr("data-blogid")&&(t=jQuery("#hrv-product-reviews").attr("data-blogid")+"-"+jQuery("#hrv-product-reviews").attr("data-id")),jQuery.ajax({type:"GET",dataType:"json",url:Host+"clientrequest/getlistreviewpaginginfo",async:!0,data:{data:JSON.stringify({hrv_product_reviews_form_shop:jQuery("#hrv_product_reviews_form_shop").val(),hrv_product_reviews_form_product:t,hrv_product_reviews_form_fullshop:jQuery("#hrv_product_reviews_form_fullshop").val(),Take:r})},success:function(e){}}).done(function(r){var t=document.getElementById("dv-product-review-paging");null!=t&&t.parentNode.removeChild(t);var i="";null!=r&&r.number_of_page>1&&(i+='<div id="dv-product-review-paging">',e>1&&(i+="<button class=\"btnPaging\" value ='1'>Trang Đầu</button>",i+='<button class="btnPaging" value = \''+(e-1)+"'>"+(e-1)+"</button>"),i+='<button class="btnPaging" disabled value =\''+e+"'>"+e+"</button>",e<r.number_of_page&&(i+='<button class="btnPaging" value =\''+(e+1)+"'>"+(e+1)+"</button>",i+='<button class="btnPaging" value =\''+r.number_of_page+"'>Trang Cuối</button>"),i+="</div>",jQuery("#hrv-product-reviews-list").after(i),jQuery(".btnPaging").each(function(){jQuery(this).on("click",function(){d.GetReview(jQuery(this).val())})}))})}};return{init:function(){d.ApplyLayoutSetting(function(){s.LoadProductReviewCSS(),s.LoadRatingCSS(),s.CreateDivSummary(),s.CreateSubmitForm(),d.ToogleSubmitForm(),d.ValidateSubmitForm(),d.GetMoreReview(),d.LoadNoReview(),d.LoadStar(),d.LoadDefaultStar(),d.LoadPagingTool(),s.VotePage()})}}}();function url_domain(e){var r=document.createElement("a");return r.href=e,r.protocol+"//"+r.host+"/"}function LoadCSS(e){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,r.media="all",document.getElementsByTagName("head")[0].appendChild(r)}function LoadScript(e){var r=document.createElement("script");r.type="text/javascript",r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}function setCookie(e,r){var t=new Date;t.setTime(t.getTime()+864e5),document.cookie=e+"="+r+";expires="+t.toUTCString()}function getCookie(e){var r=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return r?r[2]:null}jQuery.ajax({url:Host+"js/lib/jquery.raty.js",dataType:"script",cache:!0}).done(function(){ProductReviews.init()});